/**
 * @category    Mana
 * @package     ManaPro_Content
 * @copyright   Copyright (c) http://www.manadev.com
 * @license     http://www.manadev.com/license  Proprietary License
 */
Mana.define("ManaPro/Content/Book/RelatedProductGrid",["jquery","Mana/Admin/Grid","singleton:Mana/Core/Layout","singleton:Mana/Core/Ajax"],function(e,t,i){return t.extend("ManaPro/Content/Book/RelatedProductGrid",{_subscribeToBlockEvents:function(){return this._super().on("load",this,function(){this.getChild("add-related-products")&&this.getChild("add-related-products").on("click",this,this.openRelatedProductGrid),this.getChild("remove-selected")&&this.getChild("remove-selected").on("click",this,this.removeSelected)}).on("unload",this,function(){this.getChild("add-related-products")&&this.getChild("add-related-products").off("click",this,this.openRelatedProductGrid),this.getChild("remove-selected")&&this.getChild("remove-selected").off("click",this,this.removeSelected)})},addToRelatedProductChanges:function(t){this.$tabContainer().initChangesObj().related_products=e.merge(this.$tabContainer().initChangesObj().related_products,t)},removeFromRelatedProductChanges:function(t){var i=this.$tabContainer().initChangesObj().related_products;e.each(t,function(e){var n=i.indexOf(t[e]);-1!==n?i.splice(n,1):-1===i.indexOf("-"+t[e])&&i.push("-"+t[e])})},removeSelected:function(){var t=this.getRows(),i=[];e.each(t,function(n){e(t[n].getCell(0).getElement()).find("input")[0].checked&&i.push(e(t[n].getCell(1).getElement())[0].innerText)}),t.length>0&&(this.removeFromRelatedProductChanges(i),this.$tabContainer()._postAction("modify"),this._varienGrid.reload())},openRelatedProductGrid:function(){this._updateReloadParams();var t=this;e.mChooseProducts({url:this.$tabContainer().getUrl("related-product-grid-selection")+"?isAjax=true",params:function(){return{changes_related_products:t.$tabContainer().initChangesObj().related_products||{},id:t.$tabContainer().getCurrentId()}},result:function(e){e&&(t.addToRelatedProductChanges(e),t.$tabContainer()._postAction("modify"),t._varienGrid.reload())}})},$tabContainer:function(){return i.getBlock("container")},_updateReloadParams:function(){this._super(),this._varienGrid.reloadParams.id=this.$tabContainer().getCurrentId(),this._varienGrid.reloadParams.related_product_ids=this.$tabContainer().initChangesObj().related_products}})});