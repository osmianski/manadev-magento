/**
 * @category    Mana
 * @package     Mana_Content
 * @copyright   Copyright (c) http://www.manadev.com
 * @license     http://www.manadev.com/license  Proprietary License
 */
Mana.define("Mana/Content/Tree",["jquery","Mana/Core/Block"],function(t,e){return e.extend("Mana/Content/Tree",{})}),Mana.define("Mana/Content/Filter",["jquery","singleton:Mana/Core/Config"],function(t,e){return Mana.Object.extend("Mana/Content/Filter",{_init:function(){this.loadFilterFromUrl()},loadFilterFromUrl:function(){this._searchValue="",this._relatedProducts=[],this._tags=[];var t=window.location.search;t=t.substr(1,t.length-1),t=t.split("&");for(var e,n=0;n<t.length;n++)switch(e=t[n].split("="),e[0]){case"search":this._searchValue=e[1];break;case"related_products":this._relatedProducts=e[1].split(",").map(Number);break;case"tags":this._tags=e[1].split(",").map(Number)}},setSearch:function(t){return this._searchValue=t,this.constructUrl()},getUrlIfTagSelected:function(t){var e=this.addTag(t);return this.removeTag(t),e},getUrlIfTagNotSelected:function(t){var e=this.removeTag(t);return this.addTag(t),e},addTag:function(t){return this.isTagSelected(t)||this._tags.push(t),this.constructUrl()},removeTag:function(e){var n=this;return t.each(this._tags,function(t){return n._tags[t]==e?(n._tags.splice(t,1),void 0):void 0}),this.constructUrl()},isTagSelected:function(e){return-1!==t.inArray(e,this._tags)},getUrlIfRelatedProductChecked:function(t){var e=this.addToRelatedProducts(t);return this.removeFromRelatedProduct(t),e},getUrlIfRelatedProductUnchecked:function(t){var e=this.removeFromRelatedProduct(t);return this.addToRelatedProducts(t),e},setRelatedProducts:function(t){return this._relatedProducts=t,this.constructUrl()},addToRelatedProducts:function(t){return this.isProductChecked(t)||this._relatedProducts.push(t),this.constructUrl()},removeFromRelatedProduct:function(e){var n=this;return t.each(this._relatedProducts,function(t){return n._relatedProducts[t]==e?(n._relatedProducts.splice(t,1),void 0):void 0}),this.constructUrl()},isProductChecked:function(e){return-1!==t.inArray(e,this._relatedProducts)},constructUrl:function(){var n=e.getData("url.unfiltered"),a={};if(this._searchValue.length>0&&(a.search=this._searchValue),this._relatedProducts.length>0&&(a.related_products=this._relatedProducts),this._tags.length>0&&(a.tags=this._tags),a.search||a.related_products||a.tags){n+="?";var r=!0;t.each(a,function(t){r?r=!1:n+="&",n+=t+"="+a[t]})}return n}})}),Mana.define("Mana/Content/Tree/Search",["jquery","Mana/Core/Block","singleton:Mana/Core/Layout","singleton:Mana/Core/Config","singleton:Mana/Content/Filter"],function(t,e,n,a,r){return e.extend("Mana/Content/Tree/Search",{_subscribeToHtmlEvents:function(){function t(){e.changed()}var e=this;return this._super().on("bind",this,function(){this.$field().on("blur",t)}).on("unbind",this,function(){this.$field().off("blur",t)})},_subscribeToBlockEvents:function(){return this._super().on("load",this,function(){this.$field()[0].setValue(r._searchValue)})},$field:function(){return this.$().find("input")},$link:function(){return this.$().find("a")},$tree:function(){return n.getBlock("tree")},changed:function(){this.$link()[0].href=r.setSearch(this.$field()[0].getValue())}})}),Mana.define("Mana/Content/Tree/RelatedProduct",["jquery","Mana/Core/Block","singleton:Mana/Content/Filter"],function(t,e,n){return e.extend("Mana/Content/Tree/RelatedProduct",{setFilterUrl:function(t){var e=t.data("mProductId");n.isProductChecked(e)?t.addClass("m-checkbox-checked"):t.addClass("m-checkbox-unchecked"),t[0].href=t.hasClass("m-checkbox-unchecked")?n.getUrlIfRelatedProductChecked(e):n.getUrlIfRelatedProductUnchecked(e)},_subscribeToBlockEvents:function(){var e=this;return this._super().on("load",this,function(){this.$().find("a").each(function(){e.setFilterUrl(t(this))})})}})}),Mana.define("Mana/Content/Tree/Tag",["jquery","Mana/Core/Block","singleton:Mana/Content/Filter"],function(t,e,n){return e.extend("Mana/Content/Tree/Tag",{setFilterUrl:function(t){var e=t.data("mTagId");n.isTagSelected(e)&&t.addClass("m-tag-selected"),t[0].href=t.hasClass("m-tag-selected")?n.getUrlIfTagNotSelected(e):n.getUrlIfTagSelected(e)},_subscribeToBlockEvents:function(){var e=this;return this._super().on("load",this,function(){this.$().find("a").each(function(){e.setFilterUrl(t(this))})})}})}),Mana.define("Mana/Content/AjaxInterceptor",["jquery","singleton:Mana/Core/Ajax","singleton:Mana/Core/Config","singleton:Mana/Core/Layout","singleton:Mana/Content/Filter"],function(t,e,n,a,r,o){return Mana.Object.extend("Mana/Content/AjaxInterceptor",{match:function(e,a){if(a){var r=n.getData("mana_content.ajax.containers");if(r&&t(r).has(a).length>0)return!0}return!1},intercept:function(t){var i=document.createElement("a"),s=!1;i.href=t,window._gaq!==o&&(window._gaq.push(["_setAccount",n.getData("ga.account")]),window._gaq.push(["_trackPageview",t.substring(i.protocol.length+i.hostname.length+2)])),window.ga!==o&&window.ga("send","pageview",{page:t.substring(i.protocol.length+i.hostname.length+2)});var c=t;t=decodeURIComponent(t);var u=c.indexOf("?"),d=t.indexOf("?");-1!=u&&-1!=d&&(t=t.substr(0,d)+"?"+c.substr(u+1));var l=n.getData("url.base");return l+=n.getData("mana_content.ajax.urlKey"),l+="/"+n.getData("ajax.currentRoute"),l+="/"+n.getData("mana_content.ajax.routeSeparator"),l+="/"+t.substr(n.getData("url.base").length),e.get(l,function(t){return r.loadFilterFromUrl(),e.update(t),a.getPageBlock().resize(),s=!0,!0},{preventClicks:!0,encode:-1!=d?{offset:0,length:d}:o}),s}})}),Mana.require(["jquery","singleton:Mana/Core/Ajax","singleton:Mana/Content/AjaxInterceptor"],function(t,e,n){e.addInterceptor(n)});