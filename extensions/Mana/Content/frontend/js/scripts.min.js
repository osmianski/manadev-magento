/**
 * @category    Mana
 * @package     Mana_Content
 * @copyright   Copyright (c) http://www.manadev.com
 * @license     http://www.manadev.com/license  Proprietary License
 */
Mana.define("Mana/Content/Tree",["jquery","Mana/Core/Block"],function(e,t){return t.extend("Mana/Content/Tree",{})}),Mana.define("Mana/Content/Filter",["jquery","singleton:Mana/Core/Config"],function(e,t){return Mana.Object.extend("Mana/Content/Filter",{_init:function(){this.loadFilterFromUrl()},loadFilterFromUrl:function(){this._searchValue="",this._relatedProducts=[];var e=window.location.search;e=e.substr(1,e.length-1),e=e.split("&");for(var t,n=0;n<e.length;n++)switch(t=e[n].split("="),t[0]){case"search":this._searchValue=t[1];break;case"related_products":this._relatedProducts=t[1].split(",").map(Number)}},setSearch:function(e){return this._searchValue=e,this.constructUrl()},getUrlIfRelatedProductChecked:function(e){var t=this.addToRelatedProducts(e);return this.removeFromRelatedProduct(e),t},getUrlIfRelatedProductUnchecked:function(e){var t=this.removeFromRelatedProduct(e);return this.addToRelatedProducts(e),t},setRelatedProducts:function(e){return this._relatedProducts=e,this.constructUrl()},addToRelatedProducts:function(e){return this.isProductChecked(e)||this._relatedProducts.push(e),this.constructUrl()},removeFromRelatedProduct:function(t){var n=this;return e.each(this._relatedProducts,function(e){return n._relatedProducts[e]==t?(n._relatedProducts.splice(e,1),void 0):void 0}),this.constructUrl()},isProductChecked:function(t){return-1!==e.inArray(t,this._relatedProducts)},constructUrl:function(){var n=t.getData("url.unfiltered"),r={};if(this._searchValue.length>0&&(r.search=this._searchValue),this._relatedProducts.length>0&&(r.related_products=this._relatedProducts),r.search||r.related_products){n+="?";var a=!0;e.each(r,function(e){a?a=!1:n+="&",n+=e+"="+r[e]})}return n}})}),Mana.define("Mana/Content/Tree/Search",["jquery","Mana/Core/Block","singleton:Mana/Core/Layout","singleton:Mana/Core/Config","singleton:Mana/Content/Filter"],function(e,t,n,r,a){return t.extend("Mana/Content/Tree/Search",{_subscribeToHtmlEvents:function(){function e(){t.changed()}var t=this;return this._super().on("bind",this,function(){this.$field().on("blur",e)}).on("unbind",this,function(){this.$field().off("blur",e)})},_subscribeToBlockEvents:function(){return this._super().on("load",this,function(){this.$field()[0].setValue(a._searchValue)})},$field:function(){return this.$().find("input")},$link:function(){return this.$().find("a")},$tree:function(){return n.getBlock("tree")},changed:function(){this.$link()[0].href=a.setSearch(this.$field()[0].getValue())}})}),Mana.define("Mana/Content/Tree/RelatedProduct",["jquery","Mana/Core/Block","singleton:Mana/Content/Filter"],function(e,t,n){return t.extend("Mana/Content/Tree/RelatedProduct",{setFilterUrl:function(e){var t=e.data("mProductId");n.isProductChecked(t)?e.addClass("m-checkbox-checked"):e.addClass("m-checkbox-unchecked"),e[0].href=e.hasClass("m-checkbox-unchecked")?n.getUrlIfRelatedProductChecked(t):n.getUrlIfRelatedProductUnchecked(t)},_subscribeToBlockEvents:function(){var t=this;return this._super().on("load",this,function(){this.$().find("a").each(function(){t.setFilterUrl(e(this))})})}})}),Mana.define("Mana/Content/AjaxInterceptor",["jquery","singleton:Mana/Core/Ajax","singleton:Mana/Core/Config","singleton:Mana/Core/Layout","singleton:Mana/Content/Filter"],function(e,t,n,r,a,o){return Mana.Object.extend("Mana/Content/AjaxInterceptor",{match:function(t,r){if(r){var a=n.getData("mana_content.ajax.containers");if(a&&e(a).has(r).length>0)return!0}return!1},intercept:function(e){var i=document.createElement("a"),c=!1;i.href=e,window._gaq!==o&&(window._gaq.push(["_setAccount",n.getData("ga.account")]),window._gaq.push(["_trackPageview",e.substring(i.protocol.length+i.hostname.length+2)])),window.ga!==o&&window.ga("send","pageview",{page:e.substring(i.protocol.length+i.hostname.length+2)});var s=e;e=decodeURIComponent(e);var u=s.indexOf("?"),d=e.indexOf("?");-1!=u&&-1!=d&&(e=e.substr(0,d)+"?"+s.substr(u+1));var l=n.getData("url.base");return l+=n.getData("mana_content.ajax.urlKey"),l+="/"+n.getData("ajax.currentRoute"),l+="/"+n.getData("mana_content.ajax.routeSeparator"),l+="/"+e.substr(n.getData("url.base").length),t.get(l,function(e){return a.loadFilterFromUrl(),t.update(e),r.getPageBlock().resize(),c=!0,!0},{preventClicks:!0,encode:-1!=d?{offset:0,length:d}:o}),c}})}),Mana.require(["jquery","singleton:Mana/Core/Ajax","singleton:Mana/Content/AjaxInterceptor"],function(e,t,n){t.addInterceptor(n)});